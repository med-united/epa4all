server:
  http_listen_port: 3102

positions:
  filename: /tmp/positions.yaml

clients:
#  - url: http://host.docker.internal:3100/loki/api/v1/push

  - url: https://<GRAFANA_CLOUD_USER_ID>:<API_KEY>@logs-prod-012.grafana.net/api/prom/push
    basic_auth:
      username: "<GRAFANA_CLOUD_USER_ID>"
      password: "<API_KEY>"

scrape_configs:
  - job_name: epa4all
    static_configs:
    - targets:
        - localhost
      labels:
        job: epa4all
        __path__: /opt/epa4all/promtail/epa4all.log
    pipeline_stages:
      - json:
          expressions:
            time: timestamp
            loggerName: loggerName
            message: message
            thread: threadName
            level: level
            exception: stackTrace
            client: servicehealth_client_id
      - template:
          source: message
          template: '{{if .message}}{{regexReplaceAll "\\n" .message "\n"}}{{end}}'
      - template:
          source: exception
          template: '{{if .exception}}{{regexReplaceAll "\\n" .exception "\n"}}{{end}}'
      - labels:
          loggerName:
          message:
          thread:
          level:
          exception: '{{if .exception}}{{.exception}}{{end}}'
          client: '{{if .client}}{{.client}}{{end}}'
      - timestamp:
          source: time
          format: RFC3339
          location: Europe/Berlin
      - labeldrop:
          - time
